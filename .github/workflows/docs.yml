name: docs

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  workflow_dispatch:

jobs:
  createDocsPullRequest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 3

      - name: Generate docs
        run: |
          yarn install
          yarn build
          yarn docs

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: 'docs: Generate docs'
          signoff: false
          branch: actions-generate-docs
          delete-branch: true
          title: 'docs: Generate docs'
          body: |
            Docs generated using typedoc
            - PR auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          assignees: emostov
          reviewers: emostov
          draft: false

      - name: Check outputs
        run: |
          echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
          echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"

# jobs:
#   docs:
#     runs-on: ubuntu-latest
#     steps:
#     - uses: actions/checkout@v2
#       with:
#         persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal token
#         fetch-depth: 0 # otherwise, you will failed to push refs to dest repo
#     - name: Generate docs
#       run: |
#         yarn install
#         yarn build
#         yarn docs
#     - name: Commit docs
#       run: |
#         git config --local user.email "action@github.com"
#         git config --local user.name "GitHub Action"
#         git add .
#         git commit -m "docs: Generate docs"
#     - name: Push changes
#       uses: ad-m/github-push-action@master # https://github.com/marketplace/actions/github-push
#       with:
#         github_token: ${{ secrets.GITHUB_TOKEN }}
#         branch: ${{ github.ref }}
